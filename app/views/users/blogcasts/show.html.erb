<div id="alert" style="display: none;">
</div>
<div id="wrapper" class="user three-column">
  <div id="header" class="small">
    <%- form_tag username_blogcast_search_permalink_path(:username => @blogcast_user.username, :year => @blogcast.year, :month => @blogcast.month, :day => @blogcast.day, :title => @blogcast.link_title) do -%>
      <%= label_tag :query, image_tag("magnifying_glass.png") -%>
      <%= text_field_tag :query, "Search \"#{@blogcast.title}\"", :onfocus => "if (this.value == 'Search \"#{@blogcast.title}\"') this.value = ''; jQuery('#header form').addClass('selected');", :onblur => "if (this.value == '') this.value = 'Search \"#{@blogcast.title}\"'; jQuery('#header form').removeClass('selected');" -%>
    <%- end -%>
    <%= link_to(image_tag("/images/logo-small.png", :border => 0, :class => "logo"), "/") %>
    <%= image_tag "/images/beta-small.png", :class => "beta" %>
    <div id="navigation">
<% if @user.instance_of?(BlogcastrUser) -%>
      <%= link_to image_tag(@user.setting.avatar.url(:small))+@user.username, profile_path(:username => @user.username), :class => "first user" %>
      <%= link_to "Home", home_path %>
      <%= link_to "Settings", settings_path %>
      <%= link_to "Sign out", sign_out_path, :method => "delete" %>
<% elsif @user.instance_of?(FacebookUser) -%>
  <%- avatar_url = @user.get_avatar_url :small -%>
  <%- if avatar_url.nil? -%>
    <%- avatar_url = get_facebook_avatar_url @user.facebook_id %>
    <%- if avatar_url.nil? -%>
      <%- avatar = "http://static.ak.facebook.com/pics/q_silhouette_logo.gif" %>
    <%- end -%>
  <%- end -%>
  <%- username = @user.get_username -%>
  <%- if username.nil? -%>
    <%- username = get_facebook_name @user.facebook_id %>
  <%- end -%>
  <%- url = @user.get_url -%>
  <%- if url.nil? -%>
    <%- url = get_facebook_url @user.facebook_id %>
  <%- end -%>
      <%= link_to image_tag(avatar_url) + username, url, :class => "first user" %>
      <%= link_to "Sign up", sign_up_path %>
      <span onclick="FB.Connect.logout(blogcastrFacebookSignOut);">Sign out</span>
<% elsif @user.instance_of?(TwitterUser) -%>
      <%= link_to image_tag(@user.get_avatar_url(:small)) + @user.get_username, @user.get_url, :class => "first user" %>
      <%= link_to "Sign up", sign_up_path %>
      <span onclick="blogcastrTwitterSignOut();">Sign out</span>
<% else -%>
      <%= link_to "Sign up", sign_up_path %>
      <%= link_to "Sign in", sign_in_path %>
<% end -%>
    </div>
    <div class="clear">
    </div>
  </div>
  <div id="content" class="three-column">
    <%= render :partial => "/users/blogcasts/share/left_side" -%>
    <div id="main">
      <div class="top-border-medium-indent-white-squared first">
      </div>
      <div id="top">
        <div id="title" class="small indent">
          <div class="side-border">
            <div class="upper-left-border-squared-corner-gray horizontal">
            </div>
            <div class="left-border-gray">
            </div>
            <div class="lower-left-border-squared-corner-gray horizontal">
            </div>
          </div>
          <h1><%= @blogcast.title -%></h1>
          <div class="side-border">
            <div class="upper-right-border-squared-corner-gray horizontal">
            </div>
            <div class="right-border-gray">
            </div>
            <div class="lower-right-border-squared-corner-gray horizontal">
            </div>
          </div>
        </div>
        <div class="social">
          <p>Share with friends and followers</p>
          <%= link_to_function image_tag("facebook-small.png"), "FB.Connect.streamPublish('', facebook_attachment)" -%>
<%- tweet = "Viewing \"" + @blogcast.title + "\" by " + @blogcast_user.username + "." -%>
<%- if !@blogcast.short_url.nil? -%>
  <%- tweet = tweet + " " + @blogcast.short_url -%>
<%- end -%>
          <%= link_to_function image_tag("twitter-small.png"), "blogcastrTwitterShare('#{tweet}')" -%>
<% if (@user.instance_of?(BlogcastrUser) && @user != @blogcast.user) -%>
          <span>|</span>
          <span id="like-link">
  <%- if @like.nil? -%>
            <%= link_to_remote "Like", :url => blogcast_likes_path(:blogcast_id => @blogcast.id), :failure => "alert('Error: Failed communicating with server. Unable to like \"#{@blogcast.title.gsub(/'/, "\\\\'")}\".');", :html => {:class => "like add"}, :condition => "remote_request == false", :before => "remote_request = true", :complete => "setTimeout('remote_request = false', 3500)" %>
  <%- else -%>
            <%= link_to_remote "Unlike", :url => blogcast_like_path(:blogcast_id => @blogcast.id, :id => @like.id), :method => "delete", :failure => "alert('Error: Failed communicating with server. Unable to unlike \"#{@blogcast.title.gsub(/'/, "\\\\'")}\".');", :html => {:class => "like delete"}, :condition => "remote_request == false", :before => "remote_request = true", :complete => "setTimeout('remote_request = false', 3500)" %>
  <%- end -%>
          </span>
<%- end -%>
        </div>
        <p>By <a class="user" href="<%= profile_path(:username => @blogcast_user.username) -%>"><%= @blogcast_user.username -%></a></span> on <span class="date"><%= @blogcast.starting_at.strftime("%B %e, %Y") -%></span></p>
          <div class="clear">
          </div>
<% if @user != @blogcast_user || 1 -%>
        <h2 onclick="blogcastrCollapsibleEvent(this, 'comment');">Comment<%= image_tag "down.png" -%></h2>
        <div id="comment">
  <%- if signed_in? -%>
          <% remote_form_for :comment, :url => blogcast_comments_path(:blogcast_id => @blogcast.id), :html => { :id => "comment_form", :method => "post"}, :complete => "$('comment_form').reset();" do |f| -%>
            <input id="jid" type="hidden" value="" name="jid"/>
            <%= f.hidden_field :from %>
            <%= f.text_area :text, :onfocus => "jQuery(this).addClass('selected');", :onblur => "if (this.value == '') jQuery(this).removeClass('selected')" %>
            <%= f.submit "Post" %>
          <%- end -%>
          <div class="clear">
          </div>
  <%- else -%>
          <p class="first">To comment on "<%= @blogcast.title -%>" sign up or sign in.</p>
          <div id="sign-up">
            <%= link_to "Sign up!", sign_up_path -%>
            <%= link_to "Sign in!", sign_in_path -%>
            <div class="clear">
            </div>
          </div>
          <p class="connect">Or connect with Facebook or Twitter.</p>
          <a href="#" onclick="FB.Connect.requireSession(blogcastrFacebookSignIn); return false;"><img id="facebook_connect_image" src="http://static.ak.fbcdn.net/images/fbconnect/login-buttons/connect_light_medium_long.gif" alt="Facebook connect" /></a>
          <a href="#" onclick="blogcastrTwitterSignIn(); return false;"><img id="twitter_sign_in_image" src="/images/Sign-in-with-Twitter-darker.png" alt="Twitter sign in" /></a>
          <div class="clear">
          </div>
  <%- end -%>
        </div>
<% end -%>
      </div>
      <div class="bottom-border-medium-indent-white-squared">
      </div>
      <div class="top-border-medium-indent-white-squared">
      </div>
      <div id="bottom">
        <h2 class="first">Posts</h2>
        <ol id="posts">
<% i = @num_posts -%>
<% for post in @posts -%>
  <%- if post.instance_of?(TextPost) -%>
          <%= render :partial => "/share/text_post", :object => post, :locals => {:i => i - 1} -%>
  <%- elsif post.instance_of?(ImagePost) -%>
          <%= render :partial => "/share/image_post", :object => post, :locals => {:i => i - 1} -%>
  <%- elsif post.instance_of?(AudioPost) -%>
          <%= render :partial => "audio_post", :object => post -%>
  <%- elsif post.instance_of?(CommentPost) -%>
          <%= render :partial => "/share/comment_post", :object => post, :locals => {:i => i - 1} -%>
  <%- elsif post.instance_of?(Repost) -%>
          <%= render :partial => "repost", :object => post -%>
  <%- end -%>
  <%- i = i - 1 -%>
<% end -%>
        </ol>
      </div>
      <div class="bottom-border-medium-indent-white-squared">
      </div>
    </div>
    <%= render :partial => "/users/blogcasts/share/right_side" -%>
  </div>
  <div class="clear">
  </div>
  <%= render :partial => "/share/footer_small" -%>
</div>
