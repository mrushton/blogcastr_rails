<div id="alert" style="display: none;">
</div>
<div id="wrapper" class="user">
  <div id="header" class="small">
    <%- form_tag user_search_path(:username => @profile_user.username, :controller => "search") do -%>
      <%= label_tag :query, image_tag("magnifying_glass.png") -%>
      <%= text_field_tag :query, "Search #{@profile_username_possesive} Blogcastr", :onfocus => "if (this.value == 'Search #{@profile_username_possesive_escaped} Blogcastr') this.value = ''; jQuery('#header form').addClass('selected');", :onblur => "if (this.value == '') this.value = 'Search #{@profile_username_possesive_escaped} Blogcastr'; jQuery('#header form').removeClass('selected');" -%>
    <%- end -%>
    <%= link_to(image_tag("/images/logo-small.png", :class => "logo"), "/") %>
    <%= image_tag "/images/beta-small.png", :class => "beta" %>
    <div id="navigation">
<% if @user.instance_of?(BlogcastrUser) -%>
      <%= link_to image_tag(@user.setting.avatar.url(:small)) + @user.username, profile_path(:username => @user.username), :class => "user" %>
      <%= link_to "Home", home_path %>
      <%= link_to "Settings", settings_path %>
      <%= link_to "Sign out", sign_out_path, :method => "delete" %>
<% elsif @user.instance_of?(FacebookUser) -%>
  <%- avatar = @user.get_avatar_url :small %>
  <%- if avatar.nil? -%>
      <%- avatar = get_facebook_avatar_url @user.facebook_id %>
  <%- end -%>
  <%- if avatar.nil? -%>
      <%= link_to image_tag("http://static.ak.facebook.com/pics/q_silhouette_logo.gif") + @user.get_username, @user.get_url, :class => "first" %>
  <%- else -%>
      <%= link_to image_tag(avatar) + @user.get_username, @user.get_url, :class => "first user" %>
  <%- end -%>
      <%= link_to "Sign up", sign_up_path %>
      <span class="button" onclick="FB.Connect.logout(blogcastrFacebookSignOut);">Sign out</span>
<% elsif @user.instance_of?(TwitterUser) -%>
      <%= link_to image_tag(@user.get_avatar_url(:small)) + @user.get_username, @user.get_url, :class => "first user" %>
      <%= link_to "Sign up", sign_up_path %>
      <span onclick="blogcastrTwitterSignOut();">Sign out</span>
<% else -%>
      <%= link_to "Sign up", sign_up_path %>
      <%= link_to "Sign in", sign_in_path %>
<% end -%>
    </div>
    <div class="clear">
    </div>
  </div>
  <div id="content">
    <div id="main">
      <div class="upper-left-border-squared-corner">
      </div>
      <div class="top-border">
      </div>
      <div class="upper-right-border-squared-corner">
      </div>
      <div class="clear">
      </div>
      <div class="background">
        <div id="title">
          <div class="side-border">
            <div class="upper-left-border-squared-corner-gray">
            </div>
            <div class="left-border-gray">
            </div>
            <div class="lower-left-border-squared-corner-gray">
            </div>
          </div>
          <h1 class="image"><%= link_to image_tag(@profile_user.setting.avatar.url(:medium), :class => "avatar"), profile_path(:username => @profile_user.username) -%><%= @profile_user_username_possesive -%> subscriptions</h1>
          <div class="side-border">
            <div class="upper-right-border-squared-corner-gray">
            </div>
            <div class="right-border-gray">
            </div>
            <div class="lower-right-border-squared-corner-gray">
            </div>
          </div>
        </div>
        <h2><span class="counter"><%= @num_paginated_subscriptions -%></span> <%= @num_paginated_subscriptions == 1 ? "Subscription" : "Subscriptions" -%></h2>
        <ol>
<%- i = 0 -%>
<% for subscription in @paginated_subscriptions -%>
  <%- if i == 0 -%>
          <li class="user first">
  <%- else -%>
          <li class="user">
  <%- end -%>
  <%- i = i + 1 -%>
            <div class="spacer">
              <%= link_to image_tag(subscription.setting.avatar.url(:medium), :class => "avatar"), profile_path(subscription.username) -%>
              <%= link_to subscription.username, profile_path(subscription.username), :class => "username" -%>
              <br>
  <%- if !subscription.setting.location.blank? -%>
              <span class="details"><%= subscription.setting.full_name -%> | <%= subscription.setting.location -%></span>
  <%- else -%>
              <span class="details"><%= subscription.setting.full_name -%></span>
  <%- end -%>
              <div class="clear">
              </div>
              <div class="stats">
  <%- num_blogcasts = subscription.blogcasts.count -%>
  <%- num_subscribers = subscription.subscribers.count -%>
  <%- num_subscriptions = subscription.subscriptions.count -%>
                <a class="stat first" href="<%= username_blogcasts_path :username => subscription.username -%>"><span class="counter"><%= num_blogcasts -%></span><span class="name"><%= num_blogcasts == 1 ? "Blogcast" : "Blogcasts" -%></span></a>
                <a class="stat" href="<%= username_subscribers_path :username => subscription.username -%>"><span class="counter"><%= num_subscribers -%></span><span class="name"><%= num_subscribers == 1 ? "Subscriber" : "Subscribers" -%></span></a>
                <a class="stat" href="<%= username_subscriptions_path :username => subscription.username -%>"><span class="counter"><%= num_subscriptions -%></span><span class="name"><%= num_subscriptions == 1 ? "Subscription" : "Subscriptions" -%></span></a>
              </div>
            </div>
          </li>
<% end -%>
        </ol>
<% if @num_first_subscription <= @num_subscriptions -%>
        <div id="paginate">
  <%- if !@previous_page.nil? -%>
          <%= link_to "Back", username_subscriptions_path(:username => @profile_user.username, :page => @previous_page, :id => @id), :class => "button back" %>
  <%- end -%>
          <span class="paginate"><strong><%= @num_first_subscription -%>-<%= @num_last_subscription -%></strong> of <strong><%= @num_paginated_subscriptions -%></strong></span>
  <%- if !@next_page.nil? -%>
          <%= link_to "Next", username_subscriptions_path(:username => @profile_user.username, :page => @next_page, :id => @id), :class => "button next" %>
  <%- end -%>
<% end -%>
        </div>
      </div>
      <div class="last lower-left-border-squared-corner">
      </div>
      <div class="last bottom-border">
      </div>
      <div class="last lower-right-border-squared-corner">
      </div>
      <div class="clear">
      </div>
    </div>
    <div id="side">
      <div class="upper-left-border-rounded-corner">
      </div>
      <div class="top-border-large">
      </div>
      <div class="upper-right-border-rounded-corner">
      </div>
      <div class="clear">
      </div>
      <div class="background">
        <h4 class="first">Name:</h4>
        <p class="first"><%= @profile_user.setting.full_name %></p>
        <br>
<% if !@profile_user.setting.location.nil? && @profile_user.setting.location != "" %>
        <h4>Location:</h4>
        <p><%= @profile_user.setting.location %></p>
        <br>
<% end -%>
<% if !@profile_user.setting.bio.nil? && @profile_user.setting.bio != "" %>
        <h4>Bio:</h4>
        <p><%= @profile_user.setting.bio %></p>
        <br>
<% end -%>
<% if !@profile_user.setting.web.nil? && @profile_user.setting.web != "" %>
        <h4>Web:</h4>
        <a class="web" href="<%= url_for @profile_user.setting.web =~ /^http:\/\// ? @profile_user.setting.web : "http://"+@profile_user.setting.web %>"><%= @profile_user.setting.web.length > 27 ? (@profile_user.setting.web[0,23] + "...") : @profile_user.setting.web -%></a>
<% end -%>
        <hr>
        <div id="stats">
          <a class="stat first" href="<%= username_blogcasts_path :username => @profile_user.username -%>"><span class="counter"><%= @num_blogcasts -%></span><span class="name"><%= @num_blogcasts == 1 ? "Blogcast" : "Blogcasts" -%></span></a>
          <a class="stat second" href="<%= username_comments_path :username => @profile_user.username -%>"><span class="counter"><%= @num_comments -%></span><span class="name"><%= @num_comments == 1 ? "Comment" : "Comments" -%></span></a>
          <a class="stat third" href="<%= username_likes_path :username => @profile_user.username -%>"><span class="counter"><%= @num_likes -%></span><span class="name"><%= @num_likes == 1 ? "Like" : "Likes" -%></span></a>
          <a class="stat fourth" href="<%= username_posts_path :username => @profile_user.username -%>"><span class="counter"><%= @num_posts -%></span><span class="name"><%= @num_posts == 1 ? "Post" : "Posts" -%></span></a>
          <h3 class="fifth" onclick="blogcastrCollapsibleEvent(this, 'subscribers');"><span class="counter"><%= @num_subscribers -%></span><span class="name"><%= @num_subscribers == 1 ? "Subscriber" : "Subscribers" -%></span><%= image_tag "down.png" -%></h3>
          <div id="subscribers">
            <ul>
<% i = 0 -%>
<% for subscriber in @subscribers -%>
  <%- if ((i%8) == 0) -%>
    <%- if (i < 8) -%>
              <li class="first top">
    <%- else -%>
              <li class="first">
    <%- end -%>
  <%- else -%>
    <%- if (i < 8) -%>
              <li class="top">
    <%- else -%>
              <li>
    <%- end -%>
  <%- end -%>
                <%= link_to image_tag(subscriber.setting.avatar.url(:small), :class => "avatar-small", :alt => "#{subscriber.username}"), profile_path(:username => subscriber.username), :title => "#{subscriber.username}" %>
              </li>
  <%- i += 1 -%>
<% end -%>
              <div class="clear">
              </div>
<% if (@num_subscribers > 16) -%>
              <%= link_to "More", username_subscribers_path(:username => @profile_user.username), :class => "more" -%>
<% end -%>
            </ul>
          </div>
          <h3 class="sixth" onclick="blogcastrCollapsibleEvent(this, 'subscriptions')"><span class="counter"><%= @num_subscriptions -%></span> <span class="name"><%= @num_subscriptions == 1 ? "Subscription" : "Subscriptions" -%></span><%= image_tag "down.png" -%></h3>
          <div id="subscriptions">
            <ul>
<% i = 0 -%>
<% for subscription in @subscriptions -%>
  <%- if ((i%8) == 0) -%>
    <%- if (i < 8) -%>
              <li class="first top">
    <%- else -%>
              <li class="first">
    <%- end -%>
  <%- else -%>
    <%- if (i < 8) -%>
              <li class="top">
    <%- else -%>
              <li>
    <%- end -%>
  <%- end -%>
                <%= link_to image_tag(subscription.setting.avatar.url(:small), :class => "avatar-small", :alt => "#{subscription.username}"), profile_path(:username => subscription.username), :title => "#{subscription.username}" %>
              </li>
  <%- i = i + 1 -%>
<% end -%>
              <div class="clear">
              </div>
            </ul>
          </div>
        </div>
        <hr>
<% if @user.instance_of?(BlogcastrUser) -%>
  <%- if @user != @profile_user -%>
        <div id="email-notifications">
    <%- if @email_user_notification.nil? -%>
          <%= link_to_remote image_tag("email_add.png") + "<p>Email notifications for #{@profile_username_possesive} blogcasts</p>", :url => username_email_notifications_path(:username => @profile_user.username), :failure => "alert('Error communicating with server, failed to create email notifications for #{@profile_user.username}');", :html => {:class => "notification"}, :method => "post", :condition => "remote_request == false", :before => "remote_request = true", :complete => "setTimeout('remote_request = false', 3500)" %>
    <%- else -%>
          <%= link_to_remote image_tag("email_delete.png") + "<p>Email notifications for #{@profile_username_possesive} blogcasts</p>", :url => username_email_notifications_path(:username => @profile_user.username), :failure => "alert('Error communicating with server, failed to delete email notifications for #{@profile_user.username}');", :html => {:class => "notification"}, :method => "delete", :condition => "remote_request == false", :before => "remote_request = true", :complete => "setTimeout('remote_request = false', 3500)" %>
    <%- end -%>
        </div>
        <div class="clear">
        </div>
    <%- if @user.setting.mobile_confirmed == true -%>
        <div id="sms-notifications">
      <%- if @sms_user_notification.nil? -%>
          <%= link_to_remote image_tag("phone_add.png") + "<p>SMS notifications for #{@profile_username_possesive} blogcasts</p>", :url => username_sms_notifications_path(:username => @profile_user.username), :failure => "alert('Error communicating with server, failed to create sms notifications for #{@profile_user.username}');", :html => {:class => "notification"}, :method => "post", :condition => "remote_request == false", :before => "remote_request = true", :complete => "setTimeout('remote_request = false', 3500)" %>
      <%- else -%>
          <%= link_to_remote image_tag("phone_delete.png") + "<p>SMS notifications for #{@profile_username_possesive} blogcasts</p>", :url => username_sms_notifications_path(:username => @profile_user.username), :failure => "alert('Error communicating with server, failed to create sms notifications for #{@profile_user.username}');", :html => {:class => "notification"}, :method => "delete", :condition => "remote_request == false", :before => "remote_request = true", :complete => "setTimeout('remote_request = false', 3500)" %>
      <%- end -%>
        </div>
        <div class="clear">
        </div>
    <%- end -%>
  <%- end -%>
<% end -%>
        <%= link_to image_tag("feed.png")+"<p>RSS feed of #{@profile_user.username}'s blogcasts</p>", username_blogcasts_path(:username => @profile_user.username, :format => "rss"), :class => "rss" %>
        <div class="clear">
        </div>
      </div>
      <div class="last lower-left-border-rounded-corner">
      </div>
      <div class="last bottom-border-large">
      </div>
      <div class="last lower-right-border-rounded-corner">
      </div>
      <div class="clear">
      </div>
    </div>
    <div class="clear">
    </div>
  </div>
  <div id="footer">
    <span>&copy; 2010 Blogcastr</span>
    <%= link_to "About", about_path -%>
    <a href="http://blogcastr.wordpress.com">Blog</a>
    <a href="http://www.facebook.com/blogcastr">Facebook</a>
    <%= link_to "FAQ", faq_path -%>
    <%= link_to "Privacy Policy", privacy_policy_path -%>
    <%= link_to "Terms of Service", terms_of_service_path -%>
    <a href="http://twitter.com/blogcastr">Twitter</a>
  </div>
</div>
