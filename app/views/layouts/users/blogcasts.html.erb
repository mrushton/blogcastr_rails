<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title><%= @blogcast_user.name %>'s Blogcast</title>
    <link rel="stylesheet" href="/stylesheets/blogcastr.css" media="screen"/>
    <%= javascript_include_tag :defaults, "jquery.js", "strophe/b64.js", "strophe/md5.js", "strophe/sha1.js", "strophe/strophe.js", "strophe/plugins/strophe.pubsub.js", "blogcast.js", :media => "all" %>
    <style>
      body
      {
        background: url('<%= @blogcast.user.setting.background.url %>') fixed no-repeat top left;
      }
<% if @user.instance_of?(BlogcastrUser) -%>
      .avatar-small-rounded-background
      {
        background-image: url('<%= @user.setting.avatar(:small) %>');
      }
<% end -%>
      .avatar-large-rounded-background
      {
        background-image: url('<%= @blogcast.user.setting.avatar(:large) %>');
      }
    </style>
    <%= javascript_tag "var authenticity_token = \"#{form_authenticity_token}\"" %>
<% if @user.instance_of?(FacebookUser) -%>
    <%= javascript_tag "var facebook_id = #{@user.facebook_id}" %>
<% end -%>
    <script type="text/javascript">
      jQuery.noConflict();
      var hostname = "<%= HOST %>";
      var blogname = "<%= @blogcast_user.name %>";
      var nodename = "/home/blogcastr.com/<%= @blogcast_user.name %>/blog";
      var blogcast_id = <%= @blogcast.id %>;
<% if @user.instance_of?(BlogcastrUser) -%>
      var username = "<%= @user.name %>";
<% else -%>
      var username;
<% end -%>
      var server_timestamp = <%= Time.now.to_i %>
    </script>
<% if @user.instance_of?(BlogcastrUser) -%>
  <%- if Rails.env.production? -%> 
    <script type="text/javascript" src="https://blogcastr.com/ejabberd/password.js"></script>
  <%- else -%>
    <script type="text/javascript" src="/ejabberd/password.js"></script>
  <%- end -%>
<% end -%>
  </head>
  <body>
    <%= yield :layout %>
    <%= fb_connect_javascript_tag %>
    <%- init_fb_connect :app_settings => "{\"ifUserConnected\": blogcastrFacebookUserConnected, \"ifUserNotConnected\": blogcastrFacebookUserNotConnected}" %>
    <%= init_fb_connect %>
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-11177931-1");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>
